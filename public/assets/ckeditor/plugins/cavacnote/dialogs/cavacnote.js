CKEDITOR.dialog.add("cavacNoteDialog",function(c){return{title:"Cavac Note",minWidth:400,minHeight:200,contents:[{id:"tab-basic",label:"Basic Settings",elements:[{type:"text",id:"visibletext",label:"Visible text",validate:CKEDITOR.dialog.validate.notEmpty("Visible text field cannot be empty."),setup:function(a){this.setValue(a.getText())},commit:function(a){a.setText(this.getValue())}},{type:"text",id:"popuptitle",label:"Popup title",setup:function(a){this.setValue(a.getAttribute("popuptitle"))},
commit:function(a){a.setAttribute("popuptitle",this.getValue())}},{type:"textarea",id:"popuptext",label:"Popup text",validate:CKEDITOR.dialog.validate.notEmpty("Popup text field cannot be empty."),setup:function(a){a=a.getAttribute("popuptext");a=a.replace(/#BR#/gm,"\r\n");a=a.replace(/&quot;/gm,'"');a=a.replace(/&#39;/gm,"'");this.setValue(a)},commit:function(a){var b=this.getValue(),b=b.replace(/(\r\n|\n|\r)/gm,"#BR#"),b=b.replace(/"/gm,"&quot;"),b=b.replace(/'/gm,"&#39;"),b=b.replace(/</gm,"&#xab;"),
b=b.replace(/>/gm,"&#xbb;");a.setAttribute("popuptext",b)}}]}],onShow:function(){var a=c.getSelection(),b=a.getStartElement();b&&(b=b.getAscendant("span",!0));!b||"span"!=b.getName()?(b=c.document.createElement("span"),b.setAttribute("class","cavacnote"),this.insertMode=!0):this.insertMode=!1;this.element=b;this.insertMode?this.setValueOf("tab-basic","visibletext",a.getSelectedText()):this.setupContent(this.element)},onOk:function(){var a=this.element;this.commitContent(a);this.insertMode&&c.insertElement(a)}}});