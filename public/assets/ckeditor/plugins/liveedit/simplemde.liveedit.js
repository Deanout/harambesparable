function SimpleMde_BindLiveEditing(a){function m(){var b=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var c=0;c<b.length;c++)if(b[c]+"Hidden"in document)return b[c]+"Hidden";return null}function n(){var b;b=(b=m())?document[b]:!1;b?f=!1:(f=!0,g(a))}function h(b,c,a){c=b.codemirror.listSelections();0<c.length?(b.value(a.body),e=a.dt_modified,k(a),b.codemirror.focus(),b.codemirror.setSelections(c)):(b.value(a.body),e=a.dt_modified,k(a))}var d=m();d&&(d=d.replace(/[H|h]idden/,
"")+"visibilitychange",document.addEventListener(d,n));console.log(["change",a.config]);var f=!0,l=null,e=a.config.lastModified;a.config.pollUrl||alert("Invalid configuration, you must provide configuration option pollUrl to the editor.");a.config.saveUrl||alert("Invalid configuration, you must provide configuration option saveUrl to the editor.");a.config.pollTimeOut||(a.config.pollTimeOut=1E3);a.config.saveTimeOut||(a.config.saveTimeOut=3E3);a.config.requestParameters||(a.config.requestParameters=
"");var k=function(b){if(window[a.config.updateCallBack])window[a.config.updateCallBack](b)},g=function(b){pollUrl=b.config.pollUrl;l&&clearTimeout(l);l=setTimeout(function(){f&&$.ajax(pollUrl+e+"?"+b.config.requestParameters,{cache:!1,dataType:"json"}).done(function(a){console.log(JSON.stringify(a));a&&a.success&&0<a.success.length&&a.success[0].body&&h(b,a,a.success[0])}).always(function(){g(b)})},b.config.pollTimeOut)};g(a);(function(b){var a=null;b.codemirror.on("keyup",function(){f=!1;if(window[b.config.changeCallBack])window[b.config.changeCallBack]();
a&&clearTimeout(a);a=setTimeout(function(){(function(){b.value();var a=b.config.saveData;$.ajax(b.config.pollUrl+e+"?"+b.config.requestParameters,{data:a,dataType:"json",cache:!1}).done(function(c){var d=function(c){a.body=c;$.ajax(b.config.saveUrl+"?"+b.config.requestParameters,{data:a,dataType:"json",cache:!1,method:"POST"}).done(function(a){if(a.success&&a.success.id){h(b,a,a.success);if(window[b.config.saveCallBack])window[b.config.saveCallBack](a.success);f=!0;e=a.success.dt_modified}g(b)}).fail(function(){alert("Failed to save.")})};
c.success?0==c.success.length?d(b.value()):c.success&&0<c.success.length&&(confirm("Your changes conflict with those made by another user. Click OK to reload with their changes or Cancel to force your changes?")?(h(b,c,c.success[0]),e=c.success[0].dt_modified,k(c.success[0]),g(b)):d(b.value())):alert("Failed to poll on save")})})()},b.config.saveTimeOut)})})(a)};